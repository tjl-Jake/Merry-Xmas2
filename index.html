<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arix Signature Christmas 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #050705; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
                "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.15.11?external=three",
                "@react-three/drei": "https://esm.sh/@react-three/drei@9.88.13?external=three",
                "react": "https://esm.sh/react@18.2.0",
                "react-dom": "https://esm.sh/react-dom@18.2.0"
            }
        }
    </script>

    <script type="module">
        import React, { useState, useMemo, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom';
        import * as THREE from 'three';
        import { Canvas, useFrame } from '@react-three/fiber';
        import { PerspectiveCamera, OrbitControls, Stars } from '@react-three/drei';

        const CONFIG = {
            COUNT: 6000,
            ORNAMENTS: 50,
            SAGE_GREEN: '#A8BBA1',
            LEMON_YELLOW: '#F1C40F',
            TREE_H: 10,
            TREE_R: 4
        };

        // 逻辑：生成树形坐标
        const getTreePos = () => {
            const y = Math.random() * CONFIG.TREE_H;
            const r = ((CONFIG.TREE_H - y) / CONFIG.TREE_H) * CONFIG.TREE_R;
            const a = Math.random() * Math.PI * 2;
            return [Math.cos(a) * r, y - 5, Math.sin(a) * r];
        };

        const getScatterPos = () => [(Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30];

        const Experience = () => {
            const [isExploded, setIsExploded] = useState(false);
            const pointsRef = useRef();
            const instRef = useRef();

            // 数据初始化
            const { tPos, sPos, current, weights } = useMemo(() => {
                const t = new Float32Array(CONFIG.COUNT * 3);
                const s = new Float32Array(CONFIG.COUNT * 3);
                const w = new Float32Array(CONFIG.COUNT);
                for (let i = 0; i < CONFIG.COUNT; i++) {
                    t.set(getTreePos(), i * 3);
                    s.set(getScatterPos(), i * 3);
                    w[i] = 0.5 + Math.random();
                }
                return { tPos: t, sPos: s, current: new Float32Array(t), weights: w };
            }, []);

            useFrame((state, delta) => {
                const pos = pointsRef.current.geometry.attributes.position;
                for (let i = 0; i < CONFIG.COUNT; i++) {
                    const i3 = i * 3;
                    const targetX = isExploded ? sPos[i3] : tPos[i3];
                    const targetY = isExploded ? sPos[i3+1] : tPos[i3+1];
                    const targetZ = isExploded ? sPos[i3+2] : tPos[i3+2];
                    
                    pos.array[i3] += (targetX - pos.array[i3]) * delta * 2;
                    pos.array[i3+1] += (targetY - pos.array[i3+1]) * delta * 2;
                    pos.array[i3+2] += (targetZ - pos.array[i3+2]) * delta * 2;
                }
                pos.needsUpdate = true;
            });

            return (
                <>
                    <color attach="background" args={['#050805']} />
                    <fog attach="fog" args={['#050805', 10, 30]} />
                    <ambientLight intensity={0.5} />
                    <pointLight position={[10, 10, 10]} intensity={1.5} color={CONFIG.LEMON_YELLOW} />

                    <points ref={pointsRef}>
                        <bufferGeometry>
                            <bufferAttribute attach="attributes-position" count={CONFIG.COUNT} array={current} itemSize={3} />
                        </bufferGeometry>
                        <pointsMaterial size={0.05} color={CONFIG.SAGE_GREEN} transparent opacity={0.6} />
                    </points>

                    <Stars radius={50} depth={50} count={2000} factor={4} saturation={0} fade speed={1} />
                    
                    <mesh position={[0, -5.5, 0]} rotation={[-Math.PI/2, 0, 0]}>
                        <circleGeometry args={[6, 32]} />
                        <meshStandardMaterial color={CONFIG.SAGE_GREEN} transparent opacity={0.1} />
                    </mesh>

                    {/* UI 按钮 */}
                    <mesh position={[0, -7, 0]} onClick={() => setIsExploded(!isExploded)}>
                        <sphereGeometry args={[0.1]} />
                        <meshBasicMaterial transparent opacity={0} />
                    </mesh>
                </>
            );
        };

        const App = () => {
            const [exploded, setExploded] = useState(false);
            return (
                <div className="w-full h-screen">
                    <div className="absolute top-10 left-10 z-10 pointer-events-none">
                        <h1 className="text-[#E0E5D8] text-4xl font-extralight tracking-[0.5em]">ARIX</h1>
                        <p className="text-[#F1C40F] opacity-50 tracking-widest text-xs mt-2">SIGNATURE CHRISTMAS</p>
                    </div>
                    
                    <button 
                        onClick={() => setExploded(!exploded)}
                        className="absolute bottom-10 left-1/2 -translate-x-1/2 z-20 px-8 py-3 border border-[#F1C40F]/30 text-[#F1C40F] rounded-full hover:bg-[#F1C40F]/10 transition-all tracking-widest text-xs"
                    >
                        {exploded ? "REASSEMBLE" : "EXPLODE"}
                    </button>

                    <Canvas shadows>
                        <PerspectiveCamera makeDefault position={[0, 2, 15]} fov={40} />
                        <OrbitControls enableZoom={false} autoRotate={exploded} autoRotateSpeed={0.5} />
                        <Experience isExploded={exploded} />
                    </Canvas>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
